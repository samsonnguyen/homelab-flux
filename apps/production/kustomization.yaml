apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - cert-manager
  - traefik
  - ../base/prometheus
  - ../base/nextcloud
  - ../base/loki-stack
  - ../base/mqtt
  - ../base/cloudflare-ddns
  - home-assistant
  - node-red
  - media
  - chevereto
patchesStrategicMerge:
  - prometheus-values.yaml
  - nextcloud-values.yaml
  - loki-stack-values.yaml
patches:
  - target:
      kind: IngressRoute
      name: prometheus-ingress
      namespace: prometheus
    patch: |-
      - op: replace
        path: /spec/routes/0/match
        value: Host(`metrics.samsonnguyen.ca`)
  - target:
      kind: IngressRoute
      name: grafana-ingress
      namespace: prometheus
    patch: |-
      - op: replace
        path: /spec/routes/0/match
        value: Host(`grafana.samsonnguyen.ca`)
  - target:
      kind: IngressRoute
      name: nextcloud-ingress
      namespace: nextcloud
    patch: |-
      - op: replace
        path: /spec/routes/0/match
        value: Host(`cloud.samsonnguyen.ca`)

