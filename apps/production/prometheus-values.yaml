apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: prometheus
  namespace: prometheus
spec:
  chart:
    spec:
      version: ">=14.5.0"
  values:
    grafana:
      ingress: 
        enabled: false
      persistence:
        enabled: true
        storageClassName: freenas-iscsi-csi
        size: 50Gi
      grafana.ini:
        server:
          root_url: https://grafana.samsonnguyen.ca
        auth.anonymous:
          enabled: true
          org_name: admin
          org_role: Admin
    prometheus:
      ingress:
        enabled: false
      prometheusSpec:
        serviceMonitorSelectorNilUsesHelmValues: false
      additionalServiceMonitors:
        - name: nextcloud
          endpoints:
          - path: metrics
            port: metrics
          namespaceSelector:
            matchNames:
            - nextcloud
          podTargetLabels:
          - app.kubernetes.io/component=metrics
          selector:
            matchLabels:
              app.kubernetes.io/instance: nextcloud